<metal:block define-macro="calendar">BEGIN:VCALENDAR
VERSION:2.0
CALSCALE:GREGORIAN
PRODID:-//Assembly Mobile export//iCal-AsmMobile//
<tal:block tal:repeat="event view/events">BEGIN:VEVENT
SUMMARY:<span tal:replace="event/name/@@ical" />
DTSTART:<span tal:replace="event/start/@@ical" />
DTEND:<span tal:replace="event/end/@@ical" />
DTSTAMP:<span tal:replace="view/now/@@ical" />
URL:<span tal:replace="event/url/@@ical|nothing" />
UID:<span tal:replace="string:${event/id}@${view/domain}" />
DESCRIPTION:<span tal:replace="event/description/@@ical|nothing" />
CATEGORIES:<span tal:replace="python:' '.join(event.categories)" />
LOCATION:<span tal:replace="event/location/name/@@ical" />
END:VEVENT</tal:block>
END:VCALENDAR</metal:block>