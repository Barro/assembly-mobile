<metal:block metal:use-macro="context/@@layout/macros/page">
<div metal:fill-slot='content'>

<div tal:repeat="event view/events"
     tal:define="global lastStart python:None">
<h1 tal:condition="python:lastStart!=event.start.day"
    tal:content="python:event.start.strftime('%A')">Dayname</h1>

<a name="now"
   tal:condition="python: event == view.anchorEvent">
  <tal:block metal:define-macro="eventContainer">
    <span tal:condition="python: event.start <= view.now and view.now < event.end"
          tal:replace="structure python: '<div class=\'now\'>'" />
    <span tal:replace="python: '%s - %s' % (event.start.strftime('%H:%M'), event.name)" />

    <span tal:condition="python: (event.end - event.start) > view.zeroSeconds"
          tal:replace="python: '(%s)' % view.formatInterval(event.end - event.start)" />

    <span class="loc" tal:content="event/location/name"></span>
    <span tal:condition="python: event.start <= view.now and view.now < event.end"
          tal:replace="structure python: '</div>'" />

  </tal:block>
</a>

<tal:block tal:condition="python: event != view.anchorEvent">
  <span metal:use-macro="view/macros/eventContainer" />
</tal:block>

<span tal:condition="python: False"
      tal:define="global lastStart python:event.start.day" />
</div>

</div>
</metal:block >
